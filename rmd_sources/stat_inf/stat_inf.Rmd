---
title: "Statistical inference"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
if(!require("ggplot2")) { install.packages('ggplot2', repos = "http://cran.us.r-project.org"); library("ggplot2") }
```

## Confidence Intervals

We can integrate the standard normal to find the following rules of thumb:

- 95% of the density is within about 2 $\sigma$
- 68% is within about 1 $\sigma$

```{r fig.height = 3, echo=FALSE}
df1 <- data.frame(x = rnorm(1000))
p1 <- ggplot(df1, aes(x)) + theme(legend.position="none") + xlim(-4, 4)
p1 <- p1 + geom_histogram(aes(y=after_stat(density)), binwidth=0.2, na.rm=TRUE)
p1 <- p1 + stat_function(fun=dnorm, args=list(mean=0, sd=1), colour="red")
p1 <- p1 + stat_function(fun=dnorm, xlim = c(-1, 1), geom = "area")
vline_data = data.frame(x_int = c(-2, -1, 1, 2))
p1 + geom_vline(aes(xintercept=x_int, colour="red"), vline_data)
```

Another way of looking at it is that we have 95% confidence that the population mean, $\mu$, of some statistic falls inside the interval:

$$
\bar{X}_n - 2 \sigma/\sqrt{n} \leq \mu \leq \bar{X}_n + 2 \sigma/\sqrt{n}
$$

Or, in general,

$$
P(\mu \in\bar{X}_n \pm z_{(1-\alpha/2)} \sigma/\sqrt{n}) = 100(1-\alpha)\%,
$$

$z_{(1-\alpha/2)}$ being the corresponding standard normal quantile.

***

**example**

```{r echo=FALSE}
#' n: # number of rexp samples for each mean
#' k: # number of means
generate_means <- function(n, years, prob) {
  #' collect k means, each with n samples, in an array
  sample_means = NULL
  for (i in 1:years) sample_means = c(sample_means, mean(rbinom(n, size=1, prob=prob)))
  means_df <- data.frame(means = sample_means)
  means_df
}
```

Let's get away from normals for a second and talk about a different sort of process. Every year an inquiry is made into whether the good citizens of Zilcholand would like to run juice through the water lines instead of water. A yes or no from $N = 20000$ people.

A single referendum might look like this:

```{r fig.height = 3, echo = FALSE}
N <- 20000
years <- 1000
df3 <- data.frame(noyes = factor(rbinom(N, size=1, prob=0.4)))
df4 <- generate_means(N, years, 0.4)
p3 <- ggplot(df3, aes(noyes))+ geom_bar()
p3
```

If we take the average every time, after `r years` years the mean response is $`r mean(df4$means)`$

```{r fig.height = 3, echo = FALSE}
p4 <- ggplot(df4, aes(means))
p4 <- p4 + geom_histogram(aes(y=after_stat(density)), binwidth=0.001)
p4
```

***

```{r}
n <- 10000
df2 <- data.frame(x = rnorm(n))
z_95 <- qnorm(0.95)

X2 <- 1.5
low_95 <- X2 - z_95
high_95 <- X2 + z_95
```

If we choose a point, say $x = 1.5$, we can establish with 95% confidence that,

$$
`r low_95` \leq \mu \leq `r high_95`
$$

```{r fig.height = 3, echo=FALSE}
p2 <- ggplot(df2, aes(x)) + theme(legend.position="none") + xlim(-4, 4)
p2 <- p2 + geom_histogram(aes(y=after_stat(density)), binwidth=0.2, na.rm=TRUE)
p2 <- p2 + stat_function(fun=dnorm, args=list(mean=0, sd=1), colour="red")
vline_data = data.frame(x_int = c(low_95, X2, high_95))
p2 + geom_vline(aes(xintercept=x_int, colour="red"), vline_data)
```

***

[<- Statistical distributions](./stat_dist.html)

***

[Orbits!](../index.html)
